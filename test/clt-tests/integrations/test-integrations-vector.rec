––– input –––
set -b
––– output –––
––– input –––
export PATH=/usr/bin:/usr/local/bin:/usr/sbin:/sbin:/bin
––– output –––
––– input –––
apt-get update > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
apt-get -y install gnupg2 openjdk-8-jre-headless curl jq > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
mkdir /usr/share/vector && cd /usr/share/vector
––– output –––
––– input –––
bash -c "$(curl -L -s https://setup.vector.dev)" > /dev/null 2>&1
––– output –––
––– input –––
apt-get install vector > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
vector --version
––– output –––
vector 0.39.0 (x86_64-unknown-linux-gnu 73da9bb 2024-06-17 16:00:23.791735272)
––– input –––
echo -e '[sources.test_file]\ntype = "file"\ninclude = ["/var/log/dpkg.log"]\n\n[transforms.modify_test_file]\ntype = "remap"\ninputs = ["test_file"]\nsource = """\n.vec_timestamp = del(.timestamp)"""\n\n[sinks.manticore]\ntype = "elasticsearch"\ninputs = ["modify_test_file"]\nendpoints = ["http://127.0.0.1:9308"]\nbulk.index = "testlog_1"' > /usr/share/vector/vector.toml
––– output –––
––– block: ../base/start-searchd –––
––– input –––
vector -c vector.toml > /var/log/vector.log 2>&1 &
––– output –––
[1] #!/[0-9]+/!#
––– input –––
sleep 3; curl -s localhost:9308/cli_json -d 'describe testlog_1' | jq -cM '.[].data | sort_by(.Field)'
––– output –––
[{"Field":"file","Type":"text","Properties":"indexed stored"},{"Field":"host","Type":"text","Properties":"indexed stored"},{"Field":"id","Type":"bigint","Properties":""},{"Field":"message","Type":"text","Properties":"indexed stored"},{"Field":"source_type","Type":"text","Properties":"indexed stored"},{"Field":"vec_timestamp","Type":"text","Properties":"indexed stored"}]
––– input –––
mysql -P9306 -h0 -e "SHOW TABLES; SELECT * FROM testlog_1 LIMIT 3\G;"
––– output –––
+-----------+------+
| Index     | Type |
+-----------+------+
| testlog_1 | rt   |
+-----------+------+
*************************** 1. row ***************************
id: %{NUMBER}
file: /var/log/dpkg.log
host: #!/[0-9a-zA-Z]+/!#
message: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}/!# #!/[0-9]{2}:[0-9]{2}:[0-9]{2}/!# startup archives install
source_type: file
vec_timestamp: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9A-Za-z]+/!#
*************************** 2. row ***************************
id: %{NUMBER}
file: /var/log/dpkg.log
host: #!/[0-9a-zA-Z]+/!#
message: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}/!# #!/[0-9]{2}:[0-9]{2}:[0-9]{2}/!# install base-passwd:amd64 <none> 3.5.52build1
source_type: file
vec_timestamp: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9A-Za-z]+/!#
*************************** 3. row ***************************
id: %{NUMBER}
file: /var/log/dpkg.log
host: #!/[0-9a-zA-Z]+/!#
message: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}/!# #!/[0-9]{2}:[0-9]{2}:[0-9]{2}/!# status half-installed base-passwd:amd64 3.5.52build1
source_type: file
vec_timestamp: #!/[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}.[0-9A-Za-z]+/!#
