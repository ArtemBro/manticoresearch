––– input –––
set -b
––– output –––
––– input –––
export PATH=/usr/bin:/usr/local/bin:/usr/sbin:/sbin:/bin
––– output –––
––– input –––
apt-get update > /dev/null; echo $?
––– output –––
0
––– input –––
apt-get -y install gnupg2 openjdk-8-jre-headless curl jq > /dev/null; echo $?
––– output –––
debconf: delaying package configuration, since apt-utils is not installed
0
––– input –––
mkdir /usr/share/vector && cd $_
––– output –––
––– input –––
wget -P vector https://packages.timber.io/vector/0.30.0/vector_0.30.0-1_amd64.deb
––– output –––
––– input –––
tar -xvzf vector-0.30.0-x86_64-unknown-linux-gnu.tar.gz > /dev/null; echo $?
––– output –––
0
––– input –––
mkdir /usr/share/fluentbit && cd /usr/share/fluentbit
––– output –––
––– input –––
wget -q https://fluentbit.io/releases/1.8/fluent-bit-1.8.0-linux-x86_64.tar.gz
––– output –––
––– input –––
tar -xvzf fluent-bit-1.8.0-linux-x86_64.tar.gz > /dev/null; echo $?
––– output –––
0
––– input –––
cd /usr/local/src
––– output –––
––– input –––
ln -s /usr/share/vector/vector-0.30.0/bin/vector /usr/bin/vector
––– output –––
––– input –––
ln -s /usr/share/fluentbit/fluent-bit-1.8.0/bin/fluent-bit /usr/bin/fluent-bit
––– output –––
––– input –––
manticore-executor -v
––– output –––
PHP %{SEMVER} (cli) (built: #!/[a-zA-Z]{3}/!# #!/[0-9]+/!# %{YEAR} #!/[0-9]{2}:[0-9]{2}:[0-9]{2}/!#) (#!/[NZ]/!#TS)
Copyright (c) The PHP Group
Zend Engine #!/v[0-9]+\.[0-9]+\.[0-9]+/!#, Copyright (c) Zend Technologies
––– block: start-searchd –––
––– input –––
printf '[sources.in]\n  type = "file"\n  include = ["/var/log/dpkg.log"]\n\n[sinks.out]\n  type = "console"\n  inputs = ["in"]\n  target = "stdout"\n\n[sinks.elasticsearch]\n  type = "elasticsearch"\n  inputs = ["in"]\n  endpoint = "http://localhost:9308"\n  index = "testlog_1"\n  mode = "index"' > /usr/share/vector/vector.toml
––– output –––
––– input –––
timeout 60 vector --config /usr/share/vector/vector.toml 2>/dev/null 1>/var/log/vector.log && echo 'Done' || echo 'Timeout or failed'
––– output –––
Done
––– input –––
curl -s localhost:9308/cli_json -d 'describe testlog_1' | jq -cM '.[].data | sort_by(.Field)'
––– output –––
[{"Field":"@timestamp","Type":"timestamp","Properties":""},{"Field":"@version","Type":"text","Properties":"indexed stored"},{"Field":"host","Type":"text","Properties":"indexed stored"},{"Field":"id","Type":"bigint","Properties":""},{"Field":"message","Type":"text","Properties":"indexed stored"},{"Field":"path","Type":"text","Properties":"indexed stored"}]
––– input –––
printf '[SERVICE]\n    Flush        5\n    Daemon       Off\n    Log_Level    info\n\n[INPUT]\n    Name        tail\n    Path        /var/log/dpkg.log\n\n[OUTPUT]\n    Name        es\n    Match       *\n    Host        localhost\n    Port        9308\n    Index       testlog_2\n    Type        _doc' > /usr/share/fluentbit/fluentbit.conf
––– output –––
––– input –––
fluent-bit -c /usr/share/fluentbit/fluentbit.conf 2>/var/log/fluentbit.log & pid=$!
––– output –––
[1] #!/[0-9]+/!#
––– input –––
if timeout 60 grep -qm1 'Flushing records' <(tail -n 0 -f /var/log/fluentbit.log); then echo 'Done'; else echo 'Timeout or failed'; cat /var/log/fluentbit.log; cat /var/log/manticore/searchd.log; fi
––– output –––
Done
––– input –––
kill ${pid}
––– output –––
––– input –––
wait 2>&1 >/dev/null
––– output –––
[1]+  Done                    fluent-bit -c /usr/share/fluentbit/fluentbit.conf 2> /var/log/fluentbit.log
––– input –––
curl -s localhost:9308/cli_json -d 'describe testlog_2' | jq -cM '.[].data | sort_by(.Field)'
––– output –––
[{"Field":"@timestamp","Type":"timestamp","Properties":""},{"Field":"agent","Type":"json","Properties":""},{"Field":"ecs","Type":"json","Properties":""},{"Field":"host","Type":"json","Properties":""},{"Field":"id","Type":"bigint","Properties":""},{"Field":"input","Type":"json","Properties":""},{"Field":"log","Type":"json","Properties":""},{"Field":"message","Type":"text","Properties":"indexed stored"}]
