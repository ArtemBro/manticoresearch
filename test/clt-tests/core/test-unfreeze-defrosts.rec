––– block: ../base/start-searchd –––
––– input –––
set -b +m
––– output –––
––– input –––
mysql -h0 -P9306 -e "drop table if exists t; create table t(f text, s string) rt_mem_limit='128k'; insert into t values(0,'abc','string'); freeze t;" > /dev/null 2>&1
––– output –––
––– input –––
sleep 5; mysql -h0 -P9306 -e "SHOW THREADS\G;"
––– output –––
*************************** 1. row ***************************
TID: %{NUMBER}
Name: work_%{NUMBER}
Proto: mysql
State: query
Connection from: 127.0.0.1:%{NUMBER}
ConnID: %{NUMBER}
This/prev job time: %{NUMBER}#!/(s|ms|us)/!#
Jobs done: %{NUMBER}
Thread status: working
Info: SHOW THREADS
––– input –––
for n in `seq 1 1000`; do mysql -h0 -P9306 -e "insert into t values(0, 'abc', 'string string string stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring stringstring string');"; echo -n .; done 1>/dev/null &
––– output –––
[%{NUMBER}] %{NUMBER}
––– input –––
sleep 7; mysql -h0 -P9306 -e "select count(*) from t\G; unfreeze t;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 3; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 2; mysql -h0 -P9306 -e "freeze t;" > /dev/null 2>&1
––– output –––
––– input –––
sleep 7; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 3; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
mysql -h0 -P9306 -e "unfreeze t;"
––– output –––
––– input –––
sleep 3; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 3; mysql -h0 -P9306 -e "freeze t; freeze t;" > /dev/null 2>&1
––– output –––
––– input –––
sleep 3; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 7; mysql -h0 -P9306 -e "select count(*) from t\G; unfreeze t; unfreeze t;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
––– input –––
sleep 3; mysql -h0 -P9306 -e "select count(*) from t\G;"
––– output –––
*************************** 1. row ***************************
count(*): %{NUMBER}
