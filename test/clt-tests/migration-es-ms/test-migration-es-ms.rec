––– block: ../mysqldump/versions/init –––
––– input –––
docker pull -q ghcr.io/manticoresoftware/manticoresearch:test-kit-latest > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
docker pull docker.elastic.co/elasticsearch/elasticsearch:7.5.2 > /dev/null
––– output –––
––– input –––
apk add npm > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
npm install elasticdump -g elasticdump > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
docker network create test_network > /dev/null
––– output –––
––– input –––
docker run -it --privileged --network=test_network --entrypoint=docker-entrypoint.sh --platform linux/amd64 --name manticore -p 9306:9306 -p 9308:9308 -d ghcr.io/manticoresoftware/manticoresearch:test-kit-latest searchd -c /etc/manticoresearch/manticore.conf.sh --nodetach > /dev/null; echo $?
––– output –––
0
––– input –––
docker run -d --name elasticsearch --platform linux/amd64 --net test_network -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:7.5.2 > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
unzip ./test/clt-tests/migration-es-ms/index.zip -d ./test/clt-tests/migration-es-ms/
––– output –––
Archive:  ./test/clt-tests/migration-es-ms/index.zip
inflating: index_mapping.json
inflating: index_data.json
––– input –––
elasticdump --input=./test/clt-tests/migration-es-ms/index_mapping.json --output=http://localhost:9200/es_index --type=mapping
––– output –––
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | starting dump
(node:%{NUMBER}) [DEP%{NUMBER}] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 1 objects from source file (offset: 0)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 1 objects to destination elasticsearch, wrote 2
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 0 objects from source file (offset: 1)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | Total Writes: 2
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | dump complete
––– input –––
elasticdump --input=./test/clt-tests/migration-es-ms/index_data.json --output=http://localhost:9200/es-index --type=data
––– output –––
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | starting dump
(node:%{NUMBER}) [DEP%{NUMBER}] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source file (offset: 0)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source file (offset: 100)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source file (offset: 200)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source file (offset: 300)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 64 objects from source file (offset: 400)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 64 objects to destination elasticsearch, wrote 64
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 0 objects from source file (offset: 464)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | Total Writes: 464
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | dump complete
––– input –––
elasticdump --input=http://localhost:9200/es-index --output=http://localhost:9308/ms_index  --type=mapping
––– output –––
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | starting dump
(node:%{NUMBER}) [DEP%{NUMBER}] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 1 objects from source elasticsearch (offset: 0)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 1 objects to destination elasticsearch, wrote 1
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 0 objects from source elasticsearch (offset: 1)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | Total Writes: 1
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | dump complete
––– input –––
elasticdump --input=http://localhost:9200/es-index   --output=http://localhost:9308/ms_index --type=data
––– output –––
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | starting dump
(node:%{NUMBER}) [DEP%{NUMBER}] DeprecationWarning: The `punycode` module is deprecated. Please use a userland alternative instead.
(Use `node --trace-deprecation ...` to show where the warning was created)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source elasticsearch (offset: 0)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source elasticsearch (offset: 100)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source elasticsearch (offset: 200)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 100 objects from source elasticsearch (offset: 300)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 100 objects to destination elasticsearch, wrote 100
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 64 objects from source elasticsearch (offset: 400)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | sent 64 objects to destination elasticsearch, wrote 64
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | got 0 objects from source elasticsearch (offset: 464)
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | Total Writes: 464
#!/[A-Za-z]{3},\s+\d{2}\s+[A-Za-z]{3}\s+\d{4}\s+\d{2}:\d{2}:\d{2}\s+GMT/!# | dump complete
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT COUNT(*) FROM ms_index;"
––– output –––
+----------+
| count(*) |
+----------+
|      464 |
+----------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "DESCRIBE ms_index;"
––– output –––
+-----------------+-----------+------------+
| Field           | Type      | Properties |
+-----------------+-----------+------------+
| id              | bigint    |            |
| field           | text      | indexed    |
| field10         | text      | indexed    |
| field11         | text      | indexed    |
| field12         | text      | indexed    |
| field13         | text      | indexed    |
| field14         | text      | indexed    |
| field15         | text      | indexed    |
| field16         | text      | indexed    |
| field17         | text      | indexed    |
| field18         | text      | indexed    |
| field2          | text      | indexed    |
| field3          | text      | indexed    |
| field4          | text      | indexed    |
| field5          | text      | indexed    |
| field6          | text      | indexed    |
| field7          | text      | indexed    |
| field8          | text      | indexed    |
| field9          | text      | indexed    |
| message         | text      | indexed    |
| @timestamp      | timestamp |            |
| extra_timestamp | timestamp |            |
| log             | json      |            |
+-----------------+-----------+------------+
––– input –––
docker exec manticore mysql -h0 -P9306 -e "SELECT * FROM ms_index;"
––– output –––
+---------------------+------------+-----------------+------------------+
| id                  | @timestamp | extra_timestamp | log              |
+---------------------+------------+-----------------+------------------+
| 5448198095297826404 | 1712620087 |            2024 | {"level":"INFO"} |
| 9097666193355230552 | 1712620087 |            2024 | {"level":"INFO"} |
| 7381722540488568573 | 1712620087 |            2024 | {"level":"INFO"} |
| 6911901198776545583 | 1712620087 |            2024 | {"level":"INFO"} |
| 4157627641165230591 | 1712620087 |            2024 | {"level":"INFO"} |
|  948096711986651649 | 1712620087 |            2024 | {"level":"INFO"} |
| 4718977505436221020 | 1712620087 |            2024 | {"level":"INFO"} |
| 5628374973127727282 | 1712620086 |            2024 | {"level":"INFO"} |
| 6918063120946876514 | 1712620086 |            2024 | {"level":"INFO"} |
| 2003240025326794422 | 1712620086 |            2024 | {"level":"INFO"} |
| 1035703439441705855 | 1712620086 |            2024 | {"level":"INFO"} |
| 9200630174028921389 | 1712620086 |            2024 | {"level":"INFO"} |
| 4259798338765043837 | 1712620086 |            2024 | {"level":"INFO"} |
| 3777995070567678103 | 1712620086 |            2024 | {"level":"INFO"} |
| 7236771320172416990 | 1712620086 |            2024 | {"level":"INFO"} |
| 5128701379809434320 | 1712620086 |            2024 | {"level":"INFO"} |
| 8792590799816885056 | 1712620086 |            2024 | {"level":"INFO"} |
| 8828760827591472844 | 1712620086 |            2024 | {"level":"INFO"} |
| 7103584392189579473 | 1712620086 |            2024 | {"level":"INFO"} |
| 3538954593482063643 | 1712620086 |            2024 | {"level":"INFO"} |
+---------------------+------------+-----------------+------------------+
––– input –––
rm ./test/clt-tests/migration-es-ms/index_mapping.json ./test/clt-tests/migration-es-ms/index_data.json
––– output –––
